import sys
import unittest
from dataclasses import dataclass
from itertools import groupby, cycle
from textwrap import dedent

from hamcrest import assert_that, is_

from y2018 import Point, Directions


def compute(data):
    tracks, carts = parse(data)

    for cart in carts:
        cart.start(tracks)

    while True:
        for cart in sorted(carts, key=lambda c: (c.position.y, c.position.x)):
            cart.tick()

            crashes = get_crashes(carts)

            if len(crashes) > 0:
                return crashes[0][0].position.tuple()


def get_crashes(carts):
    cart_position = [list(grp)
                     for k, grp in groupby(sorted(carts, key=lambda e: e.position), key=lambda e: e.position)]

    return list(filter(lambda e: len(e) > 1, cart_position))


def compute2(data):
    tracks, carts = parse(data)

    for cart in carts:
        cart.start(tracks)

    while True:
        for cart in sorted(carts, key=lambda c: (c.position.y, c.position.x)):
            cart.tick()

            crashes = get_crashes(carts)

            for crash in crashes:
                for cart in crash:
                    carts.remove(cart)

        if len(carts) == 1:
            return carts[0].position.tuple()


corners = {
    "/": {
        Directions.DOWN: Directions.LEFT,
        Directions.UP: Directions.RIGHT,
        Directions.RIGHT: Directions.UP,
        Directions.LEFT: Directions.DOWN,
    },
    "\\": {
        Directions.DOWN: Directions.RIGHT,
        Directions.UP: Directions.LEFT,
        Directions.RIGHT: Directions.DOWN,
        Directions.LEFT: Directions.UP,
    }
}

direction_switches = {
    Directions.DOWN: {
        Directions.LEFT: Directions.RIGHT,
        Directions.RIGHT: Directions.LEFT,
    },
    Directions.RIGHT: {
        Directions.LEFT: Directions.UP,
        Directions.RIGHT: Directions.DOWN,
    },
    Directions.UP: {
        Directions.LEFT: Directions.LEFT,
        Directions.RIGHT: Directions.RIGHT,
    },
    Directions.LEFT: {
        Directions.LEFT: Directions.DOWN,
        Directions.RIGHT: Directions.UP,
    }
}


@dataclass
class Cart:
    id: int
    position: Point
    direction: Directions

    intersection_choice = None
    tracks = None

    def start(self, tracks):
        self.intersection_choice = cycle((Directions.LEFT, None, Directions.RIGHT))
        self.tracks = tracks

    def tick(self):
        self.position += self.direction.value
        new_track = self.tracks[self.position.tuple()]

        if new_track in corners:
            self.direction = corners[new_track][self.direction]
        elif new_track == "+":
            choice = next(self.intersection_choice)
            if choice is not None:
                self.direction = direction_switches[self.direction][choice]

        print(f"Cart {self.id} going to {self.position} ({new_track}) heading {self.direction}")


def parse(data):
    carts = []
    tracks = {}

    cart_chars = {
        "^": (Directions.UP, "|"),
        "v": (Directions.DOWN, "|"),
        "<": (Directions.LEFT, "-"),
        ">": (Directions.RIGHT, "-"),
    }

    cart_id = 1

    for y, line in enumerate(data.split("\n")):
        for x, char in enumerate(line):
            if char in cart_chars:
                direction, track = cart_chars[char]
                tracks[x, y] = track
                carts.append(Cart(cart_id, Point(x, y), direction))
                cart_id += 1
            elif char != " ":
                tracks[x, y] = char

    return tracks, carts


class ParseTest(unittest.TestCase):
    def test_parse(self):
        input = dedent("""\
            /->-\        
            |   |  /----\ 
            | /-+--+-\  |
            | | |  | v  |
            \-+-/  \-+--/
              \------/   """)

        tracks, carts = parse(input)

        assert_that(carts, is_([
            Cart(1, Point(2, 0), direction=Directions.RIGHT),
            Cart(2, Point(9, 3), direction=Directions.DOWN)
        ]))

        assert_that(tracks[0, 0], is_("/"))
        assert_that(tracks[7, 3], is_("|"))
        assert_that(tracks[4, 2], is_("+"))

        assert_that(tracks.get((1, 1), None), is_(None))

        # under carts
        assert_that(tracks[2, 0], is_("-"))
        assert_that(tracks[9, 3], is_("|"))


class ProvidedTest(unittest.TestCase):

    def test_part_1(self):
        input = dedent("""\
            /->-\        
            |   |  /----\ 
            | /-+--+-\  |
            | | |  | v  |
            \-+-/  \-+--/
              \------/   """)
        assert_that(compute(input), is_((7, 3)))

    def test_part_2(self):
        input = dedent("""\
            />-<\  
            |   |  
            | /<+-\ 
            | | | v
            \>+</ |
              |   ^
              \<->/""")
        assert_that(compute2(input), is_((6, 4)))


# noinspection SpellCheckingInspection
puzzle_input = """\
                                  /----------------------------\                                                                                      
  /-------------------------------+----------------------------+-----------------------\                                                              
  |                               |                            |                     /-+------------------------------------------------\             
  |               /---------------+----------------------------+---------------------+-+-\             /---------\                      |             
  |  /------------+------------\  |                            |                   /-+-+-+-------------+---------+----------------\     |             
  |  |            |            |  |                            |                   | | | |             |         |          /-----+---\ |             
  |  |        /---+------------+--+-------------------------\  |/------------------+-+-+-+-----------\ |         |          |     |   | |             
  |  |        |   |        /---+--+-------------------------+--++------------------+-+-+-+-----------+-+---------+---\      |  /--+---+-+------\      
  |  |        |   |        |/--+--+-------------------------+--++------\           | | | |           | |         |   |      |  |  |   | |      |      
  |  |        |   |        ||  |  |                         |  ||     /+-----------+-+-+-+-----------+-+---------+---+------+--+--+---+-+------+-\    
  |  | /------+---+--------++--+--+-------------------------+--++-----++-----------+-+-+\|           | |         |   |      |  |  |   | |      | |    
  |  | |      |   |        ||  |  |                    /----+--++-----++-----------+-+-+++-----------+-+---------+---+------+--+--+---+\|      | |    
  |  | |    /-+---+--------++--+--+--------------------+----+--++-<---++----------\| | |||           | |/--------+---+-\    |  |  |   |||      | |    
  |  | |    | |  /+--------++--+--+--\               /-+----+--++-----++----------++-+-+++-----------+-++--------+---+-+----+--+--+---+++-----\| |    
  |  | |    | |  ||       /++--+--+--+-----------\   | |    |  ||     ||  /-------++-+-+++-----------+-++--------+---+-+--\ |  |  |   |||     || |    
  | /+-+----+-+--++-------+++--+--+--+-----------+---+-+----+--++-----++--+-------++-+-+++-----------+-++-------\|   | |  | |  |  |   |||     || |    
  | || |    | |  ||       |||/-+--+--+-----------+---+-+----+--++-----++--+-------++-+-+++\          | ||       ||   | |  | |  |  |   |||     || |    
  | || |    | |  ||       |||| |  |  |           |   | |    |  ||     ||  | /-----++-+-++++----------+\||       ||   ^ | /+-+--+--+---+++-----++-+---\ 
  | || |    | |  ||       |||| |  |  |           |   | |    |  ||     ||  | |     || | ||||          ||||       ||   | | || |  |  |   |||     || |   |
  | || |    | |  ||       |||| |  |  |           |   | |  /-+--++-----++--+-+-----++-+-++++---\      ||||       ||   | | || |  |  |   |||     || |   |
  | || |    | |  ||       |||| |  |  |           |   | |  | |  ||     ||  | |     || | ||||   |      ||||       ||   | | || |  |  |   |||     || |   |
  | || |    | |  ||       |||| |  |/-+-----------+---+-+--+-+--++-----++--+-+-----++-+-++++---+------++++-------++---+-+-++-+--+--+---+++-\   || |   |
  \-++-+----+-+--++-------++++-+--++-+-----------+---+-+--+-+--++-----++--+-+-----++-+-/|||   |      ||||       ||   | | || |  |  |   ||| |   || |   |
    || |    | |  ||     /-++++-+--++-+-----------+---+-+--+-+--++-----++--+-+-----++-+--+++---+------++++-------++---+-+-++-+--+\ |   ||| |   || |   |
    || |    | |  || /---+-++++-+--++-+-----------+---+-+--+-+--++--\  ||  | |     || |  |||   |      ||||       ||   | | || |  || |   ||| |   || |   |
    || | /--+-+--++-+---+-++++-+--++-+-----------+---+-+--+-+--++--+--++--+-+-----++-+-\|||   |      ||||       ||   | | || |  || |   ||| |   || |   |
    || | |  | |  || |   | |||\-+--++-+-----------+---+-+--+-+--++--+--++--+-+-----++-+-+++/   |      ||||       ||   | | || |  || |   ||| |   || |   |
    || | |  | |  || |   | |||  |/-++-+---------\ |   | |  | |  ||  |  ||  | |     || | |||    |      ||||       ||   | | || |  || |   ||^ |   || |   |
  /-++-+-+--+-+--++-+---+-+++--++-++-+---------+-+---+-+--+-+--++--+--++--+-+-----++-+-+++----+-----\||||       ||   | | || |  || |   ||| |   || |   |
  | || | |  | \--++-+---+-+++--++-++-+---------+-+---+-+--+-/  ||  |  ||  | |     || |/+++----+-----+++++-\     ||   | | || |  || |   ||| |   || |   |
  | || | |  |    || |   | |||  || || |         | |   | |  |    ||  |  ||  | |     || |||||    |     ||||| |     ||   | | || |  || |   ||| |   || |   |
  | || | |  |    || |   | |||  || || |         | |   | |  |    ||  |/-++--+-+-----++-+++++----+-----+++++-+-----++---+\| || |  || |   ||| |   || |   |
  | || | |  |    || |   | |||  || || |         | |   | |/-+----++--++-++--+-+-----++-+++++----+-----+++++-+-----++---+++-++-+-\|| |   ||| |   || |   |
  | || | |  |    || |   | |\+--++-++-+---------+-+---+-++-+----++--++-++--+-+-----++-+++++----+-----+++++-+-----++---/|| || | ||| |   ||| |   || |   |
  | |\-+-+--+----++-+---+-+-+--/| || |         | |   | || |  /-++--++-++--+-+-\   || |||||    |     |||\+-+-----+/    || || | ||| |   ||| |   || |   |
  | |  \-+--+----++-+---+-+-+---+-++-+---------+-+---+-++-+--+-++--++-++--+-+-+---++-+++/|    |     ||| | |     |/----++-++-+-+++\|   ||| |   || |   |
  | |    |  | /--++-+---+-+\|   | || |         | |   | || |  | ||  || ||  | | |   || \++-+----+-----+++-+-+-----++----++-++-+-+++++---++/ |   || |   |
/-+-+----+--+-+--++-+---+-+++--\| \+-+---------+-+---+-++-+--+-/|  || ||  | | |   ||  || |    |     ||| | |     ||    || || | |||||   ||  |   || |   |
| | |    |  | |  || |   | |||  ||  | |         | |   | || |  |  |  || ||  | | |   ||  || |    |     ||| | |     ||    || || | |||||   ||  |   || |   |
| | |    | /+-+--++-+---+-+++--++--+-+---------+-+---+-++-+--+-\|  || ||  | | |/--++--++-+----+-----+++-+-+-----++----++-++-+\|||||   ||  |   || |   |
| | |    | || |  || |   | |||  ||  | |  /------+-+---+-++-+--+-++--++-++--+-+-++--++--++-+----+-----+++-+-+---\ ||    || || |||||||   ||  |   || |   |
| | |    | || |  || |   | |||  ||  | |  | /----+-+---+-++-+--+-++--++-++--+-+\||  ||  || |    |     ||| \-+---+-++----+/ || |||||||   ||  |   || |   |
| | |   /+-++-+--++-+---+-+++--++--+-+--+-+----+-+---+-++-+--+-++--++-++--+-++++--++--++-+----+-----+++---+\  |/++----+--++-+++++++--\||  |   || |   |
| | |   || || |  || |   | |||  ||  | |  | |    | |   | || |  | ||  || ||  | ||||  ||  || |    |     |||   ||  ||||    |  || |||||||  |||  |   || |   |
| | |   || || |  || | /-+-+++--++--+-+--+-+----+-+---+-++-+--+-++--++-++--+\|||| /++--++-+----+-----+++--\||  ||||    |  || |||\+++--+++--+---+/ |   |
| | |   || || |  || | | | |||  ||  | |  | |    | |   | || \--+-++--++-++--++++++-+++--++-+----/     |||  |||  ||||    |  || ||| |||  |||  |   |  |   |
| | |   || |\-+--++-+-+-+-+++--++--+-+--+-+----+-+---+-++----+-++--++-++--++++++-+/|  || |          |||  |||  ||||    |  || ||| |||  |||  |   |  |   |
| | |   || |/-+--++-+-+-+-+++--++--+-+--+-+----+-+---+-++----+-++--++-++--++++++-+-+--++-+---\      |||  |||  ||||    |  || ||| |||  |||  |   |  |   |
| | |   || ||/+--++-+-+-+-+++--++--+-+\ | |    | |/--+-++----+-++--++-++--++++++-+-+--++-+---+-\    |||  |||  ||||    |  || ||| |||  |||  |   |  |   |
| | |   || ||||  || | | | |||  ||  | || | |  /-+-++>-+-++----+-++--++-++--++++++-+-+--++-+---+-+----+++--+++--++++----+--++-+++-+++--+++--+---+\ |   |
| | | /-++-++++--++-+-+-+-+++--++--+\|| | |  | | ||  | ||    | ||  || ||  |||||\-+-+--++-+---+-+----+++--+++--++++----+--++-+/| |||  |||  |   || |   |
| ^ | | || ||||  || | | | |||  ||  |||| | |  | | ||  | \+----+-++--++-++--+++++--+-+--++-+---+-+----+++--+++--++++----+--++-+-+-+++--++/  |   || |   |
| | | | ||/++++--++-+-+-+-+++--++--++++-+-+--+-+-++--+--+----+-++--++<++--+++++--+-+--++-+---+-+-\  |||  |||  ||||    |  ||/+-+-+++--++---+--\|| |   |
| | | | |||||||  || | | | |||  ||  ||||/+-+--+-+-++--+--+----+-++--++-++--+++++--+-+--++-+--\| | |  |||  |||  ||||    |  |||| | |||  ||   |  ||| |   |
| | | | |||||||  || | | | |||  ||  |||||| |  | | ||  |  |    \-++--++-++--++++/ /+-+--++-+--++-+-+--+++--+++--++++----+-\|||| | |||  ||   |  ||| |   |
| | | | |||||||  || | | | |||  ||  |||||| |  | | ||  | /+------++--++-++\ \+++--++-+--++-+--++-+-+--+++--+++--++++----+-++/|| | |||  ||   |  ||| |   |
| | | | |||||||  || | | | |||  ||  |||||| |  | | ||  | ||/-----++--++-+++--+++--++-+--++-+--++-+-+--+++--+++--++++----+-++-++-+-+++--++---+--+++\|   |
| | | | |||\+++--++-+-+-+-+++--++--++++++-+--+-+-++--+-+++-----/|  || |||  |||  || |  || |  || | |  |||  |||  ||||    | || || | |||  ||   |  |||||   |
| | | | ||| |||  || | | | |||  ||  |||||| |/-+-+-++--+-+++------+--++-+++--+++--++-+--++-+--++-+-+--+++--+++--++++----+-++-++-+-+++\ ||   |  |||||   |
| | | | ||| |\+--++-+-+-+-+++--++--+++/|| || | | ||  | |||      |  || |||  |||  || | /++-+--++\| |  |||  |||  ||||    | || || | |||| ||   |  |||||   |
| | | | ||| | |  || | | | |||  ||  ||| || || | | ||  | |||      |  || |||  |||  || | ||| |  ||||/+--+++--+++--++++--\ | || || | |||| ||   |  |||||   |
| | | | ||| |/+--++-+-+-+-+++--++\ ||| || || | | ||  | |||      |  || |||  |||  || | ||| |  ||||||  |||  |||  ||||  | | || || | |||| ||   |  |||||   |
| | | | ||| |||  || | | | |||  ||| ||| || ||/+-+-++--+\|||      |  || |||  |||  || | ||| | /++++++--+++--+++--++++--+-+-++-++\| |||| ||   |  |||||   |
| | | | ||| |||  || | | \-+++--+++-+++-++-++++-+-++--+++++------+--++-+++--+++--++-+-+++-+-+++++++--+++--+++--++++--+-+-++-++++-/||| ||   |  |||||   |
| | | | ||| |||  || | |   |||  ||| ||| || \+++-+-++--+++++------+--++-+++--++/  || | ||| | |||||||  |||  |||  ||||  | | || ||||  ||| ||   |  |||||   |
| | v | |\+-+++--++-+-+---+++--+++-+++-++--+++-+-++--+++++------+--++-+++--++---++-+-++/ | |||||||  |||  |||  ||||  | | || ||||  ||| ||   |  |||||   |
| | | | | | |||  || | |   |||  ||| ||| ||  ||| | ||  |||\+------+--++-+++--++---++-+-++--+-+++++++--+++--+++--++++--+-+-++-+++/  ||| ||   |  |||||   |
| | | | | | |||  || |/+---+++--+++-+++-++--+++\| ||  ||| |      |  || |||/>++---++-+-++--+-+++++++--+++--+++--++++--+-+-++-+++---+++-++--\|  |||||   |
| | | | | | |||  ||/+++---+++--+++-+++-++--+++++\||  ||| |      |  || |||| ||/--++-+-++--+-+++++++--+++--+++-\||||  | | || |||   ||| ||  ||  |||||   |
| | | |/+-+-+++--++++++---+++--+++-+++-++--++++++++\ ||| |      |  ||/++++-+++--++-+\||  | |||||||  |||  ||| |||||  | | || |||   ||| ||  ||  |||||   |
| | | \++-+-+++--++++++---+++--+++-+/| ||  ||||||||| ||| |      |  ||||||| |||  || ||||  | |||||||/-+++--+++-+++++-\| | || |||   ||| ||  ||  |||||   |
| | |  || | |||  ||||||   |||  ||| | | ||  ||||||||| ||| |     /+--+++++++-+++--++-++++--+-++++++++-+++--+++-+++++-++-+-++-+++---+++-++--++--+++++\  |
| | |  || | |||  ||||||   |||  ||| \-+-++--+++++++++-+++-+-----++--+++++++-+++--++-++++--+-++++++++-+++--+++-+++++-++-+-++-+++---+++-++--+/  ||||||  |
| | |  || | |||  ||||||   |||  |||   | ||  ||||||||| ||| |     ||  ||||||| |||  || ||||  | |||||||| |||  ||| ||||| || | || |||   ||| ||  |   ||||||  |
| | |  || | ||\--++++++---+/| /+++---+-++--+++++++++-+++-+-----++--+++++++-+++--++-++++--+-++++++++-+++--+++-+++++-++-+-++-+++--\||| ||  |   ||||||  |
| \-+--++-+-++---++++++---+-+-++++---+-++--+++++++++-+++-+-----++--+++++++-+++--++-++++--+-++++++++-/||  ||| ||||| || | || |||  |||| ||  |   ||||||  |
|   |  || | ||   ||||||   | | ||||   | ||  ||||||||| ||| |     ||/-+++++++-+++\ || ||||  | ||||||||  ||  ||| ||||| || | || |||  |||| ||  |   ||||||  |
|   |  || | ||   ||||||   | | ||||   | ||  ||||||||| ||| |     ||| ||||||| |||| || ||||  | ||||||||  ||  ||| ||||| || | || |||  |||| ||  |   ||||||  |
|   |  || | ||   ||||||   | | ||||   | ||  ||||||||| ||| |     ||| ||||||| |||| || \+++--+-++++++++--++--+++-+++++-++-+-++-+++--++/| ||  |   ||||||  |
|   |  || | ||   ||||||   | | ||||   | ||  ||||||||| ||| |     ||| ||||||| |||| ||  |||  | ||||||||  ||  ||| ||||| || | || |||  || | ||  |   ||||||  |
|   |  || | ||   ||||||   | | ||||   | ||  ||||||||| ||| |     ||| ||||||| |||| ||  |||  | \+++++++--++--+++-+++++-++-+-++-++/  || | ||  |   ||||||  |
|   |  || | ||   ||||||   | | |||| /-+-++--+++++++++-+++-+-----+++-+++++++-++++-++--+++--+--+++++++--++\ ||| ||||| || | || ||   || | ||  |   ||||||  |
|   |  || | ||   ||||||   | | |||| | | ||  |\+++++++-+/| \-----+++-+++++++-++++-++--+++--+--+++++++--+++-+++-+++++-++-+-++-++---++-+-++--+---+++/||  |
|   |  || | || /-++++++---+-+\|||| | | || /+-+++++++-+-+\      ||| |||\+++-++++-++--+++--+--+++++++--+++-+++-+++++-++-+-++-++---++-+-++--+---+++-/|  |
|   |/-++-+-++-+-++++++---+-++++++-+-+-++-++-+++++++-+\||      ||| ||| ||v |||| ||  |||  |  |||||||  ||| ||| ||||| || | || ||   || | ||  |   |||  |  |
|   || || | || | ||||||   | |||||| | | || || ||||||| ||||      ||| |\+-+++-++++-++--+++--+--+++++++--+++-+++-+++++-++-/ ^| ||   || | ||  |   |||  |  |
|   || || | || | ||||||   | ||||\+-+-+-++-++-++/|||| ||||      ||| | | ||| ||\+-++--+++--+--+++++++--+++-+++-/|||| ||   || ||   || | ||  |   |||  |  |
|   || || | || | ||||||   | |||| | | | || || ||/++++-++++---\  ||| | | ||| || | ||  |||  |  |||||||  ||| |||  |||\-++---++-++---+/ | ||  |   |||  |  |
|   || |\-+-++-+-++++++---+-++++-+-+-+-++-++-+++++++-++++---+--+++-+-+-+++-++-+-++--+++--+--+++++++--+++-++/  |||  ||   || ||   |  | ||  |   |||  |  |
|   || |  | || | ||||||   | |||| | | | || || ||||||| \+++---+--+++-+-+-+++-++-+-++--+++--+--+++++++--+++-++---+++--++---++-++---+--+-++--+---+/|  |  |
|   || |  | || | ||||||   \-++++-+-+-+-++-++-++++/||  |||   |  ||| | | ||| || | ||  |||  |  |||||||  ||| ||   |||  ||   || ||   |  | ||  |   | |  |  |
|   || |  | || | ||||||     |||| | | | || || |||| ||  |||   |  ||| | | ||| || | ||  |||  |  ||||\++--+++-++---+++--+/   || ||   |  | ||  |   | |  |  |
|   || |  | || | ||||||     |||| | | | || || |||| ||  |||   |  ||| | | ||| || | |\--+++--+--++++-++--+++-/|   |||  |    || ||   |  | ||  |   | |  |  |
|   || |  | || | ||||||     |||| | | | || || |||| ||  |||   |  ||| | |/+++-++-+\|   |||  |  |||| ||  |||  |   |||  |    || ||   |  | ||  |   | |  v  |
|   || |  \-++-+-++++++-----++++-+-+-+-++-++-++++-++--+++---+--+++-+-+++++-++-+++---+++--+--++++-/|  |||  |   |||  |    |\-++---+--+-++--+---+-+--+--/
|   |\-+----++-+-++++++-----++++-+-+-+-++-++-++++-++--/||   |  ||| | ||||| || |||   |||  |  ||||  |  |||  |   |||  |    |  ||   |  | ||  |   | |  |   
|   |  | /--++-+-++++++-----++++-+-+-+-++-++-++++-++-\ ||   |  ||| | \++++-++-+++---/||  |  ||||  |  |||  |   |||  |    |  |\---+--+-+/  |   | |  |   
|   |  | |  || | ||||||/----++++-+-+-+-++\|| |||| || | ||   |  \++-+--++++-++-+++----++--+--++++--+--+++--+---+++--+----+--+----+--+-+---+---+-+--/   
|   |  | |/-++-+-+++++++----++++-+-+-+-+++++-++++-++-+-++---+---++-+--++++-++-+++\   ||  |  ||||  |  |||  |   |||  |    |  |    |  | |   |   | |      
|   |  | ||/++-+-+++++++----++++-+-+-+-+++++\|||| || | ||   |   || |  |||| || ||||   ||  |  ||||  |  |||  |   |||  |    |  |    |  | |   |   | |      
|   |  | ||||| | \++++++----++++-+-+-/ |||||||||| ||/+-++---+---++-+--++++-++-++++---++--+--++++--+-\|||  |   |||  |    |  |    |  | |   |   | |      
|   |  | ||||| \--++++++----+/|| | |   \+++++++++-++++-++---+---++-+--++++-++-++++---++--+--/|||  | ||||  |  /+++--+----+-\|    |  | |   |   | |      
|   \--+-+++++----++++++----+-++-+-+----+++++++++-++++-++---+---++-+--++++-++-++++---++--+---+++--+-++++--+--+++/  |    |/++----+--+-+---+---+\|      
|      | |||||    ||||||    \-++-+-+----+++++++++-++++-++---+---++-+--+/|| |\-++++---++--+---+++--+-++/|  |  |||   |    ||||    |  | |   |   |||      
|      | |||||    ||\+++------++-+-+----+++++++++-++++-++---+---++-/  |/++-+--++++---++--+---+++--+-++-+--+--+++---+----++++----+--+-+-\ |   |||      
|     /+-+++++---\|| |||      || | |    |||||||||/++++-++---+---++----++++-+--++++---++--+---+++--+-++-+--+--+++---+----++++-\  |  | | | |   |||      
|     || |||||   ||| |\+------++-+-+----++++++++++++++-++---+---++----++++-/  ||||   ||  |   |||  | || |  |  |||   |    |||| |  |  | | | |   |||      
|     || |||||   ||| | |      || | |    |||\++++++++++-++---+---++----++++----++++---++--+---+++--+-++-+--+--+++---+----++++-+--+--/ | | |   |||      
|     || |||||   |\+-+-+------++-+-+----+++-++++++++++-++---+---++----++++----++++---++--/   |||  | || |  |  |||   |    |||| |  |    | | |   |||      
|     || |||||   | | | |      || | |    ||| |||||||||| ||   |   \+----++++----++++---++------+++--+-+/ |  |  |||   |    |||| |  |    | | |   |||      
|     || |||||   | | | |      || | |    \++-++++++++++-++---+----+----++++----++++---++------+++--+-+--+--+--+/|   |    |||| |  |    | | |   |||      
|     || |||||   | | | |      || | |     || |||||||||| ||   |    |    ||||    ||||   ||      |||  | |  |  |  | |   |    |||| |  |    | | |   |||      
|     || |||||   | | | |      || | |     || |||||||||| ||   |    |    ||||    ||||   ||      |||  | |  |  |  | |   |    |||| |  |    | | |   |||      
|     |\-+++++---+-+-+-+------++-+-+-----++-+++++++/|| ||   |    |    ||||    ||||   ||      |||  | |  |  |  | |   |    |||| |  |    | | |   |||      
|     |  |||||   | | | |      || | |     |\-+++++++-++-+/   |    |    ||||    ||||   ||      |||  | |  |  |  | |   |    |||| |  |    | | |   |||      
|     |  |||||   | | | |      || | |     |  ||||||| \+-+----+----+----++++----++++---++------+++--+-/  |  |  | |   |    |||| |/-+----+-+-+---+++---\  
|     |  |||||   | | | |      \+-+-+-----+--+++++++--+-+----+----+----++++----++++---++------+++--+----+--+--+-+---+----++++-++-/    | | |   |||   |  
|     |  |||||   | | | |       | | |     |  |||||||  |/+----+----+----++++----++++---++------+++--+----+--+--+-+---+----++++-++------+-+-+---+++---+\ 
|     |  |||||   | | | |       | | |     |  |||||||  |||    |    |    |\++----++++---++------+++--+----+--+--+-+---+----++++-++------+-/ |   |||   || 
|     |  \++++---+-+-+-+-------+-+-+-----+--+++++++--/||    |    |    | ||/---++++---++------+++--+----+--+--+-+---+----++++-++--\   |   |   |||   || 
|     |   ||||   | | | |       | | |     |  |||||||   ||    |    |    | |||   ||\+---++--<---+++--+----+--+--+-+---+----/||| ||  |   |   |   |||   || 
|     |   ||||   | | | |       | | |     |  |\+++++---++----+----+----+-+++---++-+---++------+++--+----+--+--+-+---+-----+++-++--+---+---+---++/   || 
|     |   ||||   | | | |       | | |     |  | |||||   ||    |    |    | |||   || |   ||      |||  |    |  |  | |   |     ||| ||  |   |   |   ||    || 
|     |   ||||   | | | |       | | |     |  | |||||   ||    |    |    | |||   || |   \+------+/|  |    |  |  | |   |     ||| ||  |   |   |   ||    || 
|     |   ||||   | | | |       | | |     |  | |||||   ||    |    |    | |||   || |    |      | |  |    |  |  | |   |     ||| ||  |   |   |   ||    || 
|     |   \+++---+-+-+-+-------+-+-+-----+--+-+++++---++----+----+----+-+++---++-/    |      | |  |    |  |  | |   |     ||| ||  |   |   |   ||    || 
|     |    |||   | | | |       | | |   /-+--+-+++++---++----+----+----+-+++---++------+------+-+--+----+--+\ | |   |     ||| ||  |   |   |   ||    || 
|     |    ||\---+-+-+-+-------+-/ |   | |  | |\+++---++----/    \----+-+++---/|      |      | |  |    |  || | |   |     ||| ||  |   |   |   ||    || 
|     |    || /--+-+-+-+-------+---+\  | |  | | |||   ||              | |||    |      \------+-+--+----+--/| \-+---+-----+/| ||  |   |   |   ||    || 
|     |    \+-+--+-+-+-+-------+---++--+-+--/ | |||   ||              | |||    |             | |  |    |   |   |   |     | | ||  |   |   |   ||    || 
|     |     | |  | |/+-+-------+---++--+-+----+-+++---++--------\     | |||    |             | |  |    |   |   |   |     | | ||  |   |   |   ||    || 
|     |    /+-+--+-+++-+-------+---++--+-+----+-+++---++--------+-----+-+++----+----------->-+-+--+----+---+---+\  |     | | |\--+---+---+---++----/| 
|     |    || |  | ||| | /-----+--\||  | |    | |||   ||        |     | |||    |             | |  | /--+---+---++--+-----+-+-+---+--\|   |   ||     | 
|     |    || |  | ||| | |     |  |||  | |    | |||   ||        |     | ||\----+-------------+-+--+-+--+---+---++--+-----+-+-+---/  ||   |   ||     | 
|     |    || |  | ||| | |     |  |||  | |    | |||   ||        |     | ||     |             | |  | |  |   |   ||  |     | | |      ||   |   ||     | 
\-----+----++-+--+-+++-+-+-----/  |||  | |    | |||   ||        |     | ||     |             | |  \-+--+---+---++--/     | | |      ||   |   ||     | 
      |    || |  | ||\-+-+--------+++--+-+----/ |||   ||        |     | ||     |             | |  /-+--+---+---++--------+-+-+------++---+---++\    | 
      |    || |  | ||  | |        |||  | |      |||   ||        |     | ||     |             | |  | |  |   |   ||        | | |      ||   |   |||    | 
      \>---++-+--/ ||  | |        |||  \-+------+++---++--------+-----+-++-----+-------------+-+--+-+--+->-/   ||        \-+-+------++---+---+/|    | 
           || \----++--+-+--------++/    |      |\+---++--------+-----+-++-----+-------------+-+--+-+--+-------++----------+-/      ||   |   | |    | 
           ||      ||  | |        ||     |      | |   \+--------+-----+-++-----+-------------+-+--+-+--+-------++----------+--------++---+---+-+----/ 
           ||      ||  | |        ||     |      | \----+--------+-----+-++-----+-------------+-/  | |  |       ||          |        ||   |   | |      
           |\------++--+-+--------++-----+------+------+--------+-----+-++-----+-------------/    | |  |       ||          \--------++---+---/ |      
           |       |\--+-+---<----++-----+------+------+--------/     | ||     |                  | |  |       ||                   ||   |     |      
           |       |   | \--------/|     |      |      \--------------+-/|     |                  | \--+-------++-------------------/|   |     |      
           |       |   |           \-----+------+---------------------+--+-----+-------<----------+----/       \+--------------------/   |     |      
           |       \---+-----------------+------/                     |  |     |                  |             |                        |     |      
           |           |                 |                            \--+-----/                  \-------------+------------------------+-----/      
           \-----------+-----------------+-------------------------------+--------------------------------------/                        |            
                       \-----------------/                               \---------------------------------------------------------------/            """

if __name__ == '__main__':
    if sys.argv[1] == "2":
        result = compute2(puzzle_input)
    else:
        result = compute(puzzle_input)

    print(f"Result is {result}")
